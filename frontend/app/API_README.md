# API接口对接说明

## 概述
本项目已成功集成后端API接口，实现了用户注册、登录和登出功能。

## 接口信息

### 后端服务器
- **服务器地址**: `https://app.apidog.com/project/1067214`
- **API文档**: https://app.apidog.com/project/1067214

### 支持的接口

| 接口路径 | 方法 | 请求字段 | 响应状态码 | 说明 |
|---------|------|---------|-----------|------|
| `/register/` | POST | `username`, `character`, `password` | 201/400/409 | 用户注册 |
| `/login/` | POST | `username`, `password` | 100/400/401 | 用户登录 |
| `/logout/` | POST | `username` | 204/400 | 用户登出 |

## 项目结构变更

### 新增文件
- `src/api/index.ts` - API服务配置和接口定义
- `test.py` - Python接口测试脚本
- `API_README.md` - 本说明文档

### 修改文件
- `src/pages/LoginPage.vue` - 集成真实登录API
- `src/pages/RegisterPage.vue` - 集成真实注册API

## 功能特性

### 前端功能
1. **密码加密**: 使用SHA256对密码进行加密后发送
2. **错误处理**: 根据HTTP状态码显示相应错误信息
3. **加载状态**: 显示请求进行中的加载动画
4. **成功提示**: 操作成功后显示友好提示
5. **本地存储**: 登录成功后保存用户信息到localStorage

### API服务功能
1. **请求拦截**: 自动添加认证token（如果存在）
2. **响应拦截**: 统一处理API错误
3. **超时设置**: 10秒请求超时
4. **错误封装**: 统一的错误信息格式

## 使用方法

### 启动前端项目
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

### 运行API测试
```bash
# 确保已安装Python 3.x和requests库
pip install requests

# 运行测试脚本
python test.py
```

### 测试流程
1. 启动后端服务器（确保监听localhost）
2. 运行`test.py`脚本测试所有接口
3. 启动前端项目进行实际测试

## 接口测试说明

### 测试用户数据
测试脚本会创建以下测试用户：
- `testuser01` (volunteer) - 密码: `TestPass123`
- `testnpo01` (npo) - 密码: `TestPass123`  
- `testadmin01` (admin) - 密码: `TestPass123`

### 测试覆盖
- ✅ 注册接口 - 测试成功注册、用户名冲突、参数错误
- ✅ 登录接口 - 测试成功登录、密码错误、用户不存在
- ✅ 登出接口 - 测试成功登出、参数错误
- ✅ 404接口 - 测试未定义接口返回404

## 错误处理

### 前端错误提示
- **401**: "用户名或密码错误"
- **409**: "用户名已存在，请更换用户名"
- **400**: "请求参数错误"
- **其他**: "操作失败，请稍后重试"

### 密码验证规则
- 用户名：5-12位字母和数字组合
- 密码：12位，必须包含字母和数字
- 必须同意服务条款和隐私政策

## 注意事项

1. **后端服务**: 确保后端服务在`https://app.apidog.com/project/1067214`上运行
2. **CORS设置**: 后端需要配置CORS允许前端域名访问
3. **密码加密**: 前端使用SHA256加密，后端需要相应处理
4. **角色字段**: 注册时`character`字段使用路由参数中的角色值
5. **登录状态码**: 登录成功返回状态码100（非标准HTTP状态码）

## 开发建议

1. **环境变量**: 建议将API地址配置为环境变量
2. **Token管理**: 实现token刷新机制
3. **离线处理**: 添加网络异常的离线提示
4. **数据验证**: 增强前端表单验证
5. **单元测试**: 为API服务添加单元测试

## 故障排除

### 常见问题
1. **连接失败**: 检查后端服务是否启动
2. **CORS错误**: 检查后端CORS配置
3. **密码错误**: 确认密码加密方式一致
4. **参数错误**: 检查请求字段名称和格式

### 调试方法
1. 打开浏览器开发者工具查看网络请求
2. 查看控制台错误信息
3. 运行`test.py`脚本验证后端接口
4. 检查localStorage中的用户信息 